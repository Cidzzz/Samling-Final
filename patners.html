<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samling | Mitra Daur Ulang Pro</title>

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://kit.fontawesome.com/59135e8829.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- LEAFLET MAPS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/partner.css">
    <link rel="stylesheet" href="css/themes.css">
    <script src="javascript/theme-loader.js"></script>

</head>

<body class="m-0 p-0 overflow-y-hidden">

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <div class="container-page pb-24  pt-10 mx-0 "> 
        <!-- Header -->
        <header class="flex items-center justify-between mb-6">
            
            <div class="text-center">
                <h1 class="text-2xl font-bold text-gray-900">Partner Industri</h1>
                <p class="text-sm text-gray-400">Jaringan Daur Ulang Sidoarjo</p>
            </div>

            <div class="flex gap-2">
                <!-- NEW: Tombol Export -->
                <button onclick="exportToCSV()" class="w-10 h-10 rounded-full bg-white shadow-sm text-green-400 border border-gray-100 hover:bg-green-900 transition flex items-center justify-center" title="Export ke Excel">
                    <i class="fa-solid fa-file-arrow-down"></i>
                </button>
                <!-- Tombol Add -->
                <button class="w-10 h-10 rounded-full bg-green-600 text-white hover:bg-green-700 transition flex items-center justify-center shadow-sm shadow-green-600/20" onclick="toggleModal(true)">
                    <i class="fa-solid fa-plus"></i>
                </button>
            </div>
        </header>

        <!-- Controls -->
        <div class="flex flex-col md:flex-row gap-4 justify-between items-end md:items-center mb-6">
            <nav class="bg-white shadow-sm p-1 rounded-xl inline-flex">
                <button id="tabOrganik" onclick="switchTab('organik')" 
                    class="px-4 py-2 rounded-lg text-sm font-medium transition-all bg-green-600 text-white shadow-sm">
                    Organik
                </button>
                <button id="tabNonOrganik" onclick="switchTab('non-organik')" 
                    class="px-4 py-2 rounded-lg text-sm font-medium text-gray-400 hover:text-gray-900 transition-all">
                    Non-Organik
                </button>
            </nav>

            <div class="flex gap-2 w-full md:w-auto">
                <div class="search-container bg-white border border-gray-100 flex items-center gap-2 px-3 py-2 rounded-xl flex-1 md:w-64">
                    <i class="fa-solid fa-magnifying-glass text-gray-500 text-sm"></i>
                    <input type="text" id="searchInput" onkeyup="handleSearch()" 
                           placeholder="Cari nama mitra..." 
                           class="bg-transparent border-none outline-none text-sm text-gray-900 w-full placeholder-gray-500">
                </div>
                
                <select id="sortSelect" onchange="handleSort()" 
                        class="bg-white shadow-sm text-gray-900 text-sm border border-gray-100 rounded-xl px-3 py-2 outline-none focus:border-green-500 cursor-pointer">
                    <option value="newest">Terbaru</option>
                    <option value="nearest">Jarak Terdekat</option>
                    <option value="capacity">Kebutuhan Tertinggi</option>
                </select>
            </div>
        </div>

        <!-- Main Grid -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left: List -->
            <section class="lg:col-span-2">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-lg font-bold text-gray-900">Daftar Mitra</h3>
                    <span id="resultCount" class="text-xs text-gray-400 bg-white shadow-sm px-2 py-1 rounded-md">Memuat...</span>
                </div>
                <div id="partnersContainer" class="flex flex-col gap-4"></div>
            </section>

            <!-- Right: Stats -->
            <aside class="flex flex-col gap-4">
                <div class="bg-white rounded-xl p-5 shadow-sm">
                    <h4 class="text-gray-900 font-bold mb-1 text-lg">Analisis Kapasitas</h4>
                    <p class="text-xs text-gray-500 mb-4">Proporsi daya tampung per mitra</p>
                    <div class="relative h-48 flex justify-center">
                        <canvas id="partnersChart"></canvas>
                    </div>
                </div>

                <div class="bg-white  rounded-xl p-5 shadow-sm">
                    <h4 class="text-gray-900 font-bold mb-3">Ringkasan</h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-white border border-gray-100 p-3 rounded-lg text-center">
                            <p class="text-xs text-gray-400">Total Mitra</p>
                            <p class="text-xl font-bold text-gray-900" id="summaryCount">0</p>
                        </div>
                        <div class="bg-white border border-gray-100 p-3 rounded-lg text-center">
                            <p class="text-xs text-gray-400">Kategori Aktif</p>
                            <p class="text-sm font-bold text-green-400 uppercase" id="summaryCategory">Organik</p>
                        </div>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <main class="navbar-bottom fixed bottom-0 left-0 w-full bg-white shadow flex justify-between items-center py-2 px-60">
    <a href="beranda.html" class="flex flex-col items-center gap-1 text-gray-300">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
	<path fill="currentColor" d="M21.75 4.69v3.88a2.4 2.4 0 0 1-.71 1.72a2.47 2.47 0 0 1-1.72.71H4.68a2.42 2.42 0 0 1-2.43-2.43V4.69a2.44 2.44 0 0 1 2.43-2.44h14.64a2.44 2.44 0 0 1 1.72.72a2.4 2.4 0 0 1 .71 1.72M11 15.43v3.89a2.42 2.42 0 0 1-2.43 2.43H4.68a2.42 2.42 0 0 1-2.43-2.43v-3.88A2.44 2.44 0 0 1 4.68 13h3.89a2.42 2.42 0 0 1 1.71.72a2.46 2.46 0 0 1 .72 1.71m10.75.01v3.88a2.4 2.4 0 0 1-.71 1.72a2.47 2.47 0 0 1-1.72.71h-3.89a2.45 2.45 0 0 1-1.72-.71a2.4 2.4 0 0 1-.71-1.72v-3.88A2.46 2.46 0 0 1 15.43 13h3.89a2.44 2.44 0 0 1 1.72.72a2.4 2.4 0 0 1 .71 1.72" />
</svg>
        <span class="text-sm">Beranda</span>
    </a>

    <a href="aktivitas.html" class="flex flex-col items-center gap-1 text-gray-300">
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24">
	<path fill="#d1d5dc" d="M6.962 2.421c1.276-.171 2.908-.171 4.981-.171h.114c2.073 0 3.705 0 4.98.171c1.31.176 2.354.545 3.175 1.367c.822.821 1.19 1.866 1.367 3.174c.171 1.276.171 2.908.171 4.981v.114c0 2.073 0 3.705-.171 4.98c-.176 1.31-.545 2.354-1.367 3.175c-.821.822-1.866 1.19-3.174 1.367c-1.276.171-2.908.171-4.981.171h-.114c-2.073 0-3.705 0-4.98-.171c-1.31-.176-2.354-.545-3.175-1.367c-.822-.821-1.19-1.866-1.367-3.174c-.171-1.276-.171-2.908-.171-4.981v-.114c0-2.073 0-3.705.171-4.98c.176-1.31.545-2.354 1.367-3.175c.821-.822 1.866-1.19 3.174-1.367m4.773 4.432a.75.75 0 0 0-1.431-.132L8.492 11.25H7a.75.75 0 0 0 0 1.5h2a.75.75 0 0 0 .696-.472l1.063-2.657l1.506 7.526a.75.75 0 0 0 1.431.132l1.812-4.529H17a.75.75 0 0 0 0-1.5h-2a.75.75 0 0 0-.696.471L13.24 14.38z" />
</svg>
        <span class="text-sm">Aktivitas</span>
    </a>

    <a href="patners.html" class="flex flex-col items-center gap-1 text-green-600">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
	<path fill="#16A34A" d="M19.291 6h.71a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1h-2l-4.17-5.836a2 2 0 0 0-2.201-.753l-2.486.746a2 2 0 0 1-1.988-.502l-.293-.293a1 1 0 0 1 .152-1.539l5.401-3.6a2 2 0 0 1 2.183-.024l4.156 2.645A1 1 0 0 0 19.29 6M5.027 14.295l-1.616 1.414a1 1 0 0 0 .041 1.538l5.14 4.04a1 1 0 0 0 1.487-.29l.704-1.232a2 2 0 0 0-.257-2.338l-2.702-2.972a2 2 0 0 0-2.797-.16M7.046 5H3a1 1 0 0 0-1 1v7.516a2 2 0 0 0 .35 1.13l.074-.066l1.615-1.414a3.5 3.5 0 0 1 4.895.28l2.702 2.972a3.5 3.5 0 0 1 .45 4.09l-.655 1.146a2 2 0 0 0 1.738-.155l4.41-2.646a1 1 0 0 0 .299-1.438l-5.267-7.379a.5.5 0 0 0-.55-.188l-2.486.745a3.5 3.5 0 0 1-3.48-.877l-.293-.293a2.5 2.5 0 0 1 .38-3.848z" />
</svg>
        <span class="text-sm">Partner</span>
    </a>

    <a href="akun.html" class="flex flex-col items-center gap-1 text-gray-300">
        <i class="fa-solid fa-user text-[24px]"></i>
        <span class="text-sm">Akun</span>
    </a>
</main>

    <!-- MODAL ADD / EDIT -->
    <div id="modalAdd" class="fixed inset-0 bg-black bg-opacity-70 hidden z-[60] flex justify-center items-center p-4 backdrop-blur-sm transition-opacity">
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl p-6 transform scale-100 transition-transform">
            <div class="flex justify-between items-center mb-5">
                <h3 class="text-xl font-bold text-gray-900">Kelola Mitra</h3>
                <button onclick="toggleModal(false)" class="text-gray-400 hover:text-red-500"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <form id="formAddPartner" onsubmit="handleFormSubmit(event)" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Informasi Dasar</label>
                    <input type="text" id="inputName" required class="w-full bg-gray-50 text-gray-900 border border-gray-200 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-green-500 outline-none" placeholder="Nama Perusahaan">
                </div>
                <div class="flex items-center gap-2">
                    <input type="checkbox" id="inputVerified" class="w-4 h-4 text-green-600 rounded focus:ring-green-500">
                    <label for="inputVerified" class="text-sm text-gray-700 select-none">Tandai Mitra Terverifikasi <i class="fa-solid fa-circle-check text-blue-500 text-xs"></i></label>
                </div>
                <div>
                    <input type="text" id="inputDesc" required class="w-full bg-gray-50 text-gray-900 border border-gray-200 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-green-500 outline-none" placeholder="Deskripsi layanan">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Kategori</label>
                        <select id="inputCategory" class="w-full bg-gray-50 text-gray-900 border border-gray-200 rounded-lg px-3 py-2.5 text-sm outline-none">
                            <option value="organik">Organik</option>
                            <option value="non-organik">Non-Organik</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Jarak (KM)</label>
                        <input type="number" step="0.1" id="inputDist" required class="w-full bg-gray-50 text-gray-900 border border-gray-200 rounded-lg px-3 py-2.5 text-sm outline-none" placeholder="0.0">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Kontak & Kapasitas</label>
                    <input type="text" id="inputReq" required class="w-full bg-gray-50 text-gray-900 border border-gray-200 rounded-lg px-3 py-2.5 text-sm outline-none mb-3" placeholder="Kapasitas (Contoh: 500 kg)">
                    <div class="flex items-center gap-2 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2.5">
                        <span class="text-gray-400 text-sm font-bold">62</span>
                        <input type="number" id="inputPhone" required class="w-full bg-transparent text-gray-900 outline-none text-sm" placeholder="81234567890">
                    </div>
                </div>
                <div class="pt-2 flex gap-3">
                    <button type="button" onclick="toggleModal(false)" class="flex-1 py-2.5 rounded-xl font-semibold text-gray-600 hover:bg-gray-100 transition">Batal</button>
                    <button type="submit" class="flex-1 py-2.5 rounded-xl font-semibold text-white bg-green-600 hover:bg-green-700 shadow-sm shadow-green-600/30 transition">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL DETAIL (WITH MAP) -->
    <div id="modalDetail" class="fixed inset-0 bg-black bg-opacity-80 hidden z-[70] flex justify-center items-end sm:items-center p-0 sm:p-4 transition-all backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-t-2xl sm:rounded-2xl overflow-hidden h-[90vh] sm:h-auto flex flex-col animate-fadeIn max-h-[90vh]">
            
            <!-- Detail Header -->
            <div class="relative h-24 flex items-center justify-between px-6 bg-gray-50 border-b border-gray-100 shrink-0">
                <div>
                     <span id="detailCategory" class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider bg-gray-200 text-gray-600 mb-1 inline-block">CAT</span>
                     <h2 id="detailName" class="text-xl font-bold text-gray-900 leading-tight truncate w-64">Nama Mitra</h2>
                </div>
                <button onclick="toggleDetail(false)" class="w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 text-gray-600 flex items-center justify-center transition">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <!-- Content Scrollable -->
            <div class="flex-1 overflow-y-auto bg-white">
                
                <!-- Peta Lokasi (Leaflet) -->
                <div class="w-full h-48 bg-gray-200 relative z-0" id="mapContainer">
                    <!-- Map dirender disini -->
                </div>

                <div class="p-6">
                    <!-- Status Verified -->
                    <div id="detailVerified" class="hidden mb-4 bg-blue-50 text-blue-600 px-3 py-2 rounded-lg text-xs font-bold border border-blue-100 flex items-center gap-2">
                        <i class="fa-solid fa-circle-check text-base"></i> 
                        <span>Mitra Terverifikasi Resmi</span>
                    </div>

                    <p id="detailDesc" class="text-gray-500 text-sm mb-6 leading-relaxed">Deskripsi...</p>

                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-gray-50 p-3 rounded-xl border border-gray-100">
                            <p class="text-[10px] uppercase font-bold text-gray-400 mb-1">Jarak</p>
                            <p id="detailDist" class="text-base font-bold text-gray-900">0.0 km</p>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-xl border border-gray-100">
                            <p class="text-[10px] uppercase font-bold text-gray-400 mb-1">Kebutuhan</p>
                            <p id="detailReq" class="text-base font-bold text-gray-900 truncate">0 kg</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Bar -->
            <div class="p-4 border-t border-gray-100 bg-gray-50 grid grid-cols-4 gap-3 shrink-0">
                <button onclick="handleCall()" class="col-span-2 flex items-center justify-center gap-2 py-3 rounded-xl bg-green-600 text-white hover:bg-green-700 transition shadow-sm shadow-green-600/20">
                    <i class="fa-brands fa-whatsapp text-lg"></i>
                    <span class="text-sm font-bold">WhatsApp</span>
                </button>
                <button id="btnEditAction" class="flex flex-col items-center justify-center gap-1 py-2 rounded-xl bg-white border border-gray-200 hover:bg-yellow-50 hover:border-yellow-200 hover:text-yellow-600 transition text-gray-500">
                    <i class="fa-solid fa-pen-to-square"></i>
                </button>
                <button id="btnDeleteAction" class="flex flex-col items-center justify-center gap-1 py-2 rounded-xl bg-white border border-gray-200 hover:bg-red-50 hover:border-red-200 hover:text-red-600 transition text-gray-500">
                    <i class="fa-solid fa-trash"></i>
                </button>
            </div>
        </div>
    </div>
<script src="javascript/partner_data.js"></script>
<script src="javascript/partner.js"></script>
<script src="javascript/global.js"></script>
</body>
</html>